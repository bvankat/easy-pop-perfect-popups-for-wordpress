<?xml version="1.0" encoding="UTF-8"?>
<artefact xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="artefact.xsd" name="Modal Builder" slug="modal-builder" type="code-package" schemaVersion="2">
  <file path="readme.txt">
    <description>This file contains the readme information for the block. It is used to provide information about the block, its usage, and any other relevant details.</description>
    <content><![CDATA[
=== Modal Builder ===

Contributors:      WordPress Telex
Tags:              block, modal, popup, overlay, custom post type
Tested up to:      6.8
Stable tag:        0.1.0
License:           GPLv2 or later
License URI:       https://www.gnu.org/licenses/gpl-2.0.html

A powerful modal and popup builder that integrates seamlessly with the WordPress block editor, allowing you to create stunning modals using any WordPress blocks.

== Description ==

Modal Builder transforms the way you create popups and modals in WordPress. Instead of being limited to basic form builders, you can now use the full power of the block editor to design your modal content.

= Key Features =

* **Block Editor Integration** - Design modals using any WordPress blocks you want
* **Custom Post Type** - Manage all your modals in one place
* **Flexible Triggers** - Choose when to show your modals:
  - On page load
  - After time delay
  - On scroll percentage
  - On click (via CSS selector)
  - On exit intent
* **Display Frequency Control** - Control how often modals appear:
  - Once per session
  - Once per day
  - Always show
* **Device Targeting** - Show modals on specific devices:
  - Desktop only
  - Tablet only
  - Mobile only
  - Or any combination
* **Lightweight & Fast** - Minimal JavaScript and CSS footprint
* **Accessible** - Full keyboard navigation and focus management
* **Smooth Animations** - Beautiful fade-in effects
* **Dismissible** - Close button and optional backdrop click to dismiss

= Use Cases =

* Newsletter signups
* Special offers and promotions
* Important announcements
* Lead generation forms
* Video presentations
* Survey and feedback collection
* Cookie consent notices
* Age verification gates
* Exit intent offers

= How It Works =

1. Create a new Modal from the WordPress admin
2. Design your modal content using any blocks you want
3. Configure trigger conditions (when to show)
4. Set display frequency (how often to show)
5. Choose device visibility (where to show)
6. Publish and watch it work on your site!

The plugin automatically handles all the technical details including:
- Cookie-based frequency management
- Scroll position tracking
- Exit intent detection
- Responsive behavior
- Accessibility features
- Animation timing

== Installation ==

1. Upload the plugin files to the `/wp-content/plugins/modal-builder` directory, or install the plugin through the WordPress plugins screen directly.
2. Activate the plugin through the 'Plugins' screen in WordPress
3. Navigate to 'Modals' in the admin menu to create your first modal
4. Design your modal content using the block editor
5. Configure your display settings in the post sidebar
6. Publish your modal

== Frequently Asked Questions ==

= Can I use any WordPress blocks in my modals? =

Yes! The modal content area supports all WordPress blocks, including third-party blocks from other plugins.

= How does the frequency control work? =

The plugin uses cookies to track when a modal has been shown. Based on your settings, it will respect the display frequency you've chosen.

= Can I have multiple modals on the same page? =

Yes, you can create as many modals as you need. Each modal's trigger conditions are evaluated independently.

= Is the modal accessible? =

Absolutely! The modal includes proper ARIA labels, focus trapping, keyboard navigation (ESC to close), and focus restoration when closed.

= Does it work on mobile devices? =

Yes! The modal is fully responsive and you can even choose to show modals only on specific device types.

= How do I trigger a modal on button click? =

Set the trigger to "Click" and provide a CSS selector (like ".open-modal-button" or "#special-offer-btn"). Any element matching that selector will open the modal when clicked.

= Can I customize the modal styling? =

Yes! The modal uses minimal base styles, and you can add custom CSS to match your site's design. The modal content inherits your theme's block styles.

= Does it impact site performance? =

No! The plugin is optimized for performance with minimal JavaScript (under 3KB) and CSS. Modals only load the resources they need.

== Screenshots ==

1. Modal post type management screen
2. Block editor interface for designing modal content
3. Modal display settings panel
4. Frontend modal with smooth animations
5. Mobile responsive modal view

== Changelog ==

= 0.1.0 =
* Initial release
* Custom post type for modals
* Block editor integration
* Multiple trigger options
* Frequency control
* Device targeting
* Accessibility features
* Smooth animations

== Technical Details ==

= Trigger Options =

* **Page Load** - Modal appears immediately when page loads
* **Time Delay** - Modal appears after X seconds
* **Scroll Percentage** - Modal appears when user scrolls to X% of page
* **Click** - Modal appears when element matching CSS selector is clicked
* **Exit Intent** - Modal appears when user moves cursor toward browser close button

= Browser Support =

* Chrome (latest)
* Firefox (latest)
* Safari (latest)
* Edge (latest)

= Performance =

* JavaScript: ~2.8KB minified
* CSS: ~1.2KB minified
* No external dependencies
* Efficient event handling with debouncing
* Cookie-based frequency control

= Accessibility Features =

* Focus trapping within modal
* Keyboard navigation (ESC to close, TAB to navigate)
* ARIA labels and roles
* Focus restoration on close
* Screen reader friendly
]]></content>
  </file>
  <file path="modal-builder.php">
    <description>This file contains the block registration code in the form of a single block plugin. Any other plugin related functionality should be added to this file. All block rendering functionality should go to the `render.php` file.</description>
    <content><![CDATA[<?php
/**
 * Plugin Name:       Modal Builder
 * Description:       Create beautiful modals and popups using the WordPress block editor with powerful targeting and display options.
 * Version:           0.1.0
 * Requires at least: 6.1
 * Requires PHP:      7.4
 * Author:            WordPress Telex
 * License:           GPLv2 or later
 * License URI:       https://www.gnu.org/licenses/gpl-2.0.html
 * Text Domain:       modal-builder
 *
 * @package ModalBuilder
 */

if ( ! defined( 'ABSPATH' ) ) {
	exit;
}

/**
 * Register the modal custom post type.
 */
function modal_builder_register_post_type() {
	$labels = array(
		'name'                  => _x( 'Popups', 'Post type general name', 'modal-builder' ),
		'singular_name'         => _x( 'Popup', 'Post type singular name', 'modal-builder' ),
		'menu_name'             => _x( 'Popups', 'Admin Menu text', 'modal-builder' ),
		'name_admin_bar'        => _x( 'Popup', 'Add New on Toolbar', 'modal-builder' ),
		'add_new'               => __( 'Add New', 'modal-builder' ),
		'add_new_item'          => __( 'Add New Popup', 'modal-builder' ),
		'new_item'              => __( 'New Popup', 'modal-builder' ),
		'edit_item'             => __( 'Edit Popup', 'modal-builder' ),
		'view_item'             => __( 'View Popup', 'modal-builder' ),
		'all_items'             => __( 'All Popups', 'modal-builder' ),
		'search_items'          => __( 'Search Popups', 'modal-builder' ),
		'not_found'             => __( 'No popups found.', 'modal-builder' ),
		'not_found_in_trash'    => __( 'No popups found in Trash.', 'modal-builder' ),
		'item_published'        => __( 'Popup published.', 'modal-builder' ),
		'item_updated'          => __( 'Popup updated.', 'modal-builder' ),
	);

	$args = array(
		'labels'             => $labels,
		'public'             => false,
		'publicly_queryable' => false,
		'show_ui'            => true,
		'show_in_menu'       => true,
		'menu_icon'          => 'dashicons-welcome-view-site',
		'query_var'          => false,
		'rewrite'            => false,
		'capability_type'    => 'post',
		'has_archive'        => false,
		'hierarchical'       => false,
		'menu_position'      => 20,
		'supports'           => array( 'title', 'editor', 'custom-fields' ),
		'show_in_rest'       => true,
		'template'           => array(
			array( 'core/paragraph', array(
				'placeholder' => __( 'Start designing your popup content here using any blocks...', 'modal-builder' ),
			) ),
		),
	);

	register_post_type( 'modal', $args );
}
add_action( 'init', 'modal_builder_register_post_type' );

/**
 * Add settings submenu page.
 */
function modal_builder_add_settings_page() {
	add_submenu_page(
		'edit.php?post_type=modal',
		__( 'Default Settings', 'modal-builder' ),
		__( 'Settings', 'modal-builder' ),
		'manage_options',
		'modal-builder-settings',
		'modal_builder_render_settings_page'
	);
}
add_action( 'admin_menu', 'modal_builder_add_settings_page' );

/**
 * Get default settings.
 */
function modal_builder_get_defaults() {
	$defaults = array(
		'modal_trigger_type' => 'page_load',
		'modal_trigger_delay' => 0,
		'modal_trigger_scroll_percentage' => 50,
		'modal_trigger_click_selector' => '',
		'modal_trigger_inactivity_seconds' => 30,
		'modal_trigger_scroll_element' => '',
		'modal_page_views_threshold' => 0,
		'modal_session_threshold' => 0,
		'modal_frequency_limit' => 0,
		'modal_frequency_period' => 'month',
		'modal_user_targeting' => 'all',
		'modal_devices' => 'all',
		'modal_browsers' => 'all',
		'modal_schedule_start' => '',
		'modal_schedule_end' => '',
		'modal_referrer_filter' => '',
		'modal_position' => 'center',
		'modal_animation' => 'fade',
		'modal_overlay_opacity' => 75,
		'modal_show_close_button' => true,
		'modal_backdrop_close' => true,
		'modal_esc_close' => true,
	);

	$saved_defaults = get_option( 'modal_builder_defaults', array() );
	return wp_parse_args( $saved_defaults, $defaults );
}

/**
 * Render settings page.
 */
function modal_builder_render_settings_page() {
	if ( ! current_user_can( 'manage_options' ) ) {
		return;
	}

	if ( isset( $_POST['modal_builder_save_defaults'] ) && check_admin_referer( 'modal_builder_defaults' ) ) {
		$defaults = array();
		$fields = array(
			'modal_trigger_type',
			'modal_trigger_delay',
			'modal_trigger_scroll_percentage',
			'modal_trigger_click_selector',
			'modal_trigger_inactivity_seconds',
			'modal_trigger_scroll_element',
			'modal_page_views_threshold',
			'modal_session_threshold',
			'modal_frequency_limit',
			'modal_frequency_period',
			'modal_user_targeting',
			'modal_devices',
			'modal_browsers',
			'modal_schedule_start',
			'modal_schedule_end',
			'modal_referrer_filter',
			'modal_position',
			'modal_animation',
			'modal_overlay_opacity',
		);

		foreach ( $fields as $field ) {
			if ( isset( $_POST[ $field ] ) ) {
				$defaults[ $field ] = sanitize_text_field( wp_unslash( $_POST[ $field ] ) );
			}
		}

		$defaults['modal_show_close_button'] = isset( $_POST['modal_show_close_button'] );
		$defaults['modal_backdrop_close'] = isset( $_POST['modal_backdrop_close'] );
		$defaults['modal_esc_close'] = isset( $_POST['modal_esc_close'] );

		update_option( 'modal_builder_defaults', $defaults );
		echo '<div class="notice notice-success is-dismissible"><p>' . esc_html__( 'Default settings saved successfully!', 'modal-builder' ) . '</p></div>';
	}

	$defaults = modal_builder_get_defaults();
	?>
	<div class="wrap">
		<h1><?php echo esc_html__( 'Popup Default Settings', 'modal-builder' ); ?></h1>
		<p><?php echo esc_html__( 'These default settings will be applied to all new popups. Existing popups will not be affected.', 'modal-builder' ); ?></p>

		<form method="post" action="">
			<?php wp_nonce_field( 'modal_builder_defaults' ); ?>

			<h2 class="title"><?php echo esc_html__( 'Triggers', 'modal-builder' ); ?></h2>
			<table class="form-table" role="presentation">
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Trigger Type', 'modal-builder' ); ?></th>
					<td>
						<select name="modal_trigger_type" id="modal_trigger_type">
							<option value="page_load" <?php selected( $defaults['modal_trigger_type'], 'page_load' ); ?>><?php echo esc_html__( 'On Page Load', 'modal-builder' ); ?></option>
							<option value="scroll" <?php selected( $defaults['modal_trigger_type'], 'scroll' ); ?>><?php echo esc_html__( 'On Scroll', 'modal-builder' ); ?></option>
							<option value="click" <?php selected( $defaults['modal_trigger_type'], 'click' ); ?>><?php echo esc_html__( 'On Click', 'modal-builder' ); ?></option>
							<option value="exit_intent" <?php selected( $defaults['modal_trigger_type'], 'exit_intent' ); ?>><?php echo esc_html__( 'Exit Intent', 'modal-builder' ); ?></option>
							<option value="inactivity" <?php selected( $defaults['modal_trigger_type'], 'inactivity' ); ?>><?php echo esc_html__( 'After Inactivity', 'modal-builder' ); ?></option>
							<option value="scroll_element" <?php selected( $defaults['modal_trigger_type'], 'scroll_element' ); ?>><?php echo esc_html__( 'On Scroll To Element', 'modal-builder' ); ?></option>
						</select>
					</td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Delay (seconds)', 'modal-builder' ); ?></th>
					<td><input type="number" name="modal_trigger_delay" value="<?php echo esc_attr( $defaults['modal_trigger_delay'] ); ?>" min="0" max="60" /></td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Scroll Percentage', 'modal-builder' ); ?></th>
					<td><input type="number" name="modal_trigger_scroll_percentage" value="<?php echo esc_attr( $defaults['modal_trigger_scroll_percentage'] ); ?>" min="0" max="100" /></td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Click Selector', 'modal-builder' ); ?></th>
					<td><input type="text" name="modal_trigger_click_selector" value="<?php echo esc_attr( $defaults['modal_trigger_click_selector'] ); ?>" class="regular-text" /></td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Inactivity Duration (seconds)', 'modal-builder' ); ?></th>
					<td><input type="number" name="modal_trigger_inactivity_seconds" value="<?php echo esc_attr( $defaults['modal_trigger_inactivity_seconds'] ); ?>" min="5" max="300" /></td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Scroll Element Selector', 'modal-builder' ); ?></th>
					<td><input type="text" name="modal_trigger_scroll_element" value="<?php echo esc_attr( $defaults['modal_trigger_scroll_element'] ); ?>" class="regular-text" /></td>
				</tr>
			</table>

			<h2 class="title"><?php echo esc_html__( 'Display Rules', 'modal-builder' ); ?></h2>
			<table class="form-table" role="presentation">
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Page Views Threshold', 'modal-builder' ); ?></th>
					<td><input type="number" name="modal_page_views_threshold" value="<?php echo esc_attr( $defaults['modal_page_views_threshold'] ); ?>" min="0" max="50" /></td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Session Threshold', 'modal-builder' ); ?></th>
					<td><input type="number" name="modal_session_threshold" value="<?php echo esc_attr( $defaults['modal_session_threshold'] ); ?>" min="0" max="20" /></td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Frequency Limit', 'modal-builder' ); ?></th>
					<td><input type="number" name="modal_frequency_limit" value="<?php echo esc_attr( $defaults['modal_frequency_limit'] ); ?>" min="0" max="50" /></td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Frequency Period', 'modal-builder' ); ?></th>
					<td>
						<select name="modal_frequency_period">
							<option value="session" <?php selected( $defaults['modal_frequency_period'], 'session' ); ?>><?php echo esc_html__( 'Per Session', 'modal-builder' ); ?></option>
							<option value="day" <?php selected( $defaults['modal_frequency_period'], 'day' ); ?>><?php echo esc_html__( 'Per Day', 'modal-builder' ); ?></option>
							<option value="week" <?php selected( $defaults['modal_frequency_period'], 'week' ); ?>><?php echo esc_html__( 'Per Week', 'modal-builder' ); ?></option>
							<option value="month" <?php selected( $defaults['modal_frequency_period'], 'month' ); ?>><?php echo esc_html__( 'Per Month', 'modal-builder' ); ?></option>
							<option value="lifetime" <?php selected( $defaults['modal_frequency_period'], 'lifetime' ); ?>><?php echo esc_html__( 'Lifetime', 'modal-builder' ); ?></option>
						</select>
					</td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default User Targeting', 'modal-builder' ); ?></th>
					<td>
						<select name="modal_user_targeting">
							<option value="all" <?php selected( $defaults['modal_user_targeting'], 'all' ); ?>><?php echo esc_html__( 'All Users', 'modal-builder' ); ?></option>
							<option value="logged_in" <?php selected( $defaults['modal_user_targeting'], 'logged_in' ); ?>><?php echo esc_html__( 'Logged In Only', 'modal-builder' ); ?></option>
							<option value="logged_out" <?php selected( $defaults['modal_user_targeting'], 'logged_out' ); ?>><?php echo esc_html__( 'Logged Out Only', 'modal-builder' ); ?></option>
						</select>
					</td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Device Targeting', 'modal-builder' ); ?></th>
					<td>
						<select name="modal_devices">
							<option value="all" <?php selected( $defaults['modal_devices'], 'all' ); ?>><?php echo esc_html__( 'All Devices', 'modal-builder' ); ?></option>
							<option value="desktop" <?php selected( $defaults['modal_devices'], 'desktop' ); ?>><?php echo esc_html__( 'Desktop Only', 'modal-builder' ); ?></option>
							<option value="tablet" <?php selected( $defaults['modal_devices'], 'tablet' ); ?>><?php echo esc_html__( 'Tablet Only', 'modal-builder' ); ?></option>
							<option value="mobile" <?php selected( $defaults['modal_devices'], 'mobile' ); ?>><?php echo esc_html__( 'Mobile Only', 'modal-builder' ); ?></option>
						</select>
					</td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Browser Detection', 'modal-builder' ); ?></th>
					<td>
						<select name="modal_browsers">
							<option value="all" <?php selected( $defaults['modal_browsers'], 'all' ); ?>><?php echo esc_html__( 'All Browsers', 'modal-builder' ); ?></option>
							<option value="chrome" <?php selected( $defaults['modal_browsers'], 'chrome' ); ?>><?php echo esc_html__( 'Chrome Only', 'modal-builder' ); ?></option>
							<option value="firefox" <?php selected( $defaults['modal_browsers'], 'firefox' ); ?>><?php echo esc_html__( 'Firefox Only', 'modal-builder' ); ?></option>
							<option value="safari" <?php selected( $defaults['modal_browsers'], 'safari' ); ?>><?php echo esc_html__( 'Safari Only', 'modal-builder' ); ?></option>
							<option value="edge" <?php selected( $defaults['modal_browsers'], 'edge' ); ?>><?php echo esc_html__( 'Edge Only', 'modal-builder' ); ?></option>
						</select>
					</td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Referrer Filter', 'modal-builder' ); ?></th>
					<td><input type="text" name="modal_referrer_filter" value="<?php echo esc_attr( $defaults['modal_referrer_filter'] ); ?>" class="regular-text" /></td>
				</tr>
			</table>

			<h2 class="title"><?php echo esc_html__( 'Display Options', 'modal-builder' ); ?></h2>
			<table class="form-table" role="presentation">
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Position', 'modal-builder' ); ?></th>
					<td>
						<select name="modal_position">
							<option value="center" <?php selected( $defaults['modal_position'], 'center' ); ?>><?php echo esc_html__( 'Center', 'modal-builder' ); ?></option>
							<option value="top-left" <?php selected( $defaults['modal_position'], 'top-left' ); ?>><?php echo esc_html__( 'Top Left', 'modal-builder' ); ?></option>
							<option value="top-center" <?php selected( $defaults['modal_position'], 'top-center' ); ?>><?php echo esc_html__( 'Top Center', 'modal-builder' ); ?></option>
							<option value="top-right" <?php selected( $defaults['modal_position'], 'top-right' ); ?>><?php echo esc_html__( 'Top Right', 'modal-builder' ); ?></option>
							<option value="bottom-left" <?php selected( $defaults['modal_position'], 'bottom-left' ); ?>><?php echo esc_html__( 'Bottom Left', 'modal-builder' ); ?></option>
							<option value="bottom-center" <?php selected( $defaults['modal_position'], 'bottom-center' ); ?>><?php echo esc_html__( 'Bottom Center', 'modal-builder' ); ?></option>
							<option value="bottom-right" <?php selected( $defaults['modal_position'], 'bottom-right' ); ?>><?php echo esc_html__( 'Bottom Right', 'modal-builder' ); ?></option>
						</select>
					</td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Animation Effect', 'modal-builder' ); ?></th>
					<td>
						<select name="modal_animation">
							<option value="fade" <?php selected( $defaults['modal_animation'], 'fade' ); ?>><?php echo esc_html__( 'Fade', 'modal-builder' ); ?></option>
							<option value="slide-up" <?php selected( $defaults['modal_animation'], 'slide-up' ); ?>><?php echo esc_html__( 'Slide Up', 'modal-builder' ); ?></option>
							<option value="slide-down" <?php selected( $defaults['modal_animation'], 'slide-down' ); ?>><?php echo esc_html__( 'Slide Down', 'modal-builder' ); ?></option>
							<option value="slide-left" <?php selected( $defaults['modal_animation'], 'slide-left' ); ?>><?php echo esc_html__( 'Slide Left', 'modal-builder' ); ?></option>
							<option value="slide-right" <?php selected( $defaults['modal_animation'], 'slide-right' ); ?>><?php echo esc_html__( 'Slide Right', 'modal-builder' ); ?></option>
							<option value="zoom-in" <?php selected( $defaults['modal_animation'], 'zoom-in' ); ?>><?php echo esc_html__( 'Zoom In', 'modal-builder' ); ?></option>
							<option value="zoom-out" <?php selected( $defaults['modal_animation'], 'zoom-out' ); ?>><?php echo esc_html__( 'Zoom Out', 'modal-builder' ); ?></option>
						</select>
					</td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Overlay Opacity', 'modal-builder' ); ?></th>
					<td><input type="number" name="modal_overlay_opacity" value="<?php echo esc_attr( $defaults['modal_overlay_opacity'] ); ?>" min="0" max="100" /></td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Close Button', 'modal-builder' ); ?></th>
					<td><input type="checkbox" name="modal_show_close_button" value="1" <?php checked( $defaults['modal_show_close_button'], true ); ?> /></td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default Backdrop Close', 'modal-builder' ); ?></th>
					<td><input type="checkbox" name="modal_backdrop_close" value="1" <?php checked( $defaults['modal_backdrop_close'], true ); ?> /></td>
				</tr>
				<tr>
					<th scope="row"><?php echo esc_html__( 'Default ESC Key Close', 'modal-builder' ); ?></th>
					<td><input type="checkbox" name="modal_esc_close" value="1" <?php checked( $defaults['modal_esc_close'], true ); ?> /></td>
				</tr>
			</table>

			<?php submit_button( __( 'Save Default Settings', 'modal-builder' ), 'primary', 'modal_builder_save_defaults' ); ?>
		</form>
	</div>
	<?php
}

/**
 * Register meta fields with default values for new popups.
 */
function modal_builder_register_meta() {
	$defaults = modal_builder_get_defaults();

	// Trigger settings
	register_post_meta( 'modal', 'modal_trigger_type', array(
		'type'         => 'string',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_trigger_type'],
	) );

	register_post_meta( 'modal', 'modal_trigger_delay', array(
		'type'         => 'number',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_trigger_delay'],
	) );

	register_post_meta( 'modal', 'modal_trigger_scroll_percentage', array(
		'type'         => 'number',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_trigger_scroll_percentage'],
	) );

	register_post_meta( 'modal', 'modal_trigger_click_selector', array(
		'type'         => 'string',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_trigger_click_selector'],
	) );

	register_post_meta( 'modal', 'modal_trigger_inactivity_seconds', array(
		'type'         => 'number',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_trigger_inactivity_seconds'],
	) );

	register_post_meta( 'modal', 'modal_trigger_scroll_element', array(
		'type'         => 'string',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_trigger_scroll_element'],
	) );

	// Display rules
	register_post_meta( 'modal', 'modal_page_views_threshold', array(
		'type'         => 'number',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_page_views_threshold'],
	) );

	register_post_meta( 'modal', 'modal_session_threshold', array(
		'type'         => 'number',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_session_threshold'],
	) );

	register_post_meta( 'modal', 'modal_frequency_limit', array(
		'type'         => 'number',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_frequency_limit'],
	) );

	register_post_meta( 'modal', 'modal_frequency_period', array(
		'type'         => 'string',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_frequency_period'],
	) );

	register_post_meta( 'modal', 'modal_user_targeting', array(
		'type'         => 'string',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_user_targeting'],
	) );

	register_post_meta( 'modal', 'modal_devices', array(
		'type'         => 'string',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_devices'],
	) );

	register_post_meta( 'modal', 'modal_browsers', array(
		'type'         => 'string',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_browsers'],
	) );

	register_post_meta( 'modal', 'modal_schedule_start', array(
		'type'         => 'string',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_schedule_start'],
	) );

	register_post_meta( 'modal', 'modal_schedule_end', array(
		'type'         => 'string',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_schedule_end'],
	) );

	register_post_meta( 'modal', 'modal_referrer_filter', array(
		'type'         => 'string',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_referrer_filter'],
	) );

	// Display options
	register_post_meta( 'modal', 'modal_position', array(
		'type'         => 'string',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_position'],
	) );

	register_post_meta( 'modal', 'modal_animation', array(
		'type'         => 'string',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_animation'],
	) );

	register_post_meta( 'modal', 'modal_overlay_opacity', array(
		'type'         => 'number',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_overlay_opacity'],
	) );

	register_post_meta( 'modal', 'modal_show_close_button', array(
		'type'         => 'boolean',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_show_close_button'],
	) );

	register_post_meta( 'modal', 'modal_backdrop_close', array(
		'type'         => 'boolean',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_backdrop_close'],
	) );

	register_post_meta( 'modal', 'modal_esc_close', array(
		'type'         => 'boolean',
		'single'       => true,
		'show_in_rest' => true,
		'default'      => $defaults['modal_esc_close'],
	) );
}
add_action( 'init', 'modal_builder_register_meta' );

/**
 * Enqueue modal scripts and styles on frontend.
 */
function modal_builder_enqueue_frontend_assets() {
	if ( is_admin() ) {
		return;
	}

	$modals = get_posts( array(
		'post_type'      => 'modal',
		'post_status'    => 'publish',
		'posts_per_page' => -1,
	) );

	if ( empty( $modals ) ) {
		return;
	}

	$modal_data = array();
	foreach ( $modals as $modal ) {
		$schedule_start = get_post_meta( $modal->ID, 'modal_schedule_start', true );
		$schedule_end = get_post_meta( $modal->ID, 'modal_schedule_end', true );
		$current_time = current_time( 'timestamp' );

		// Check schedule
		if ( $schedule_start && strtotime( $schedule_start ) > $current_time ) {
			continue;
		}
		if ( $schedule_end && strtotime( $schedule_end ) < $current_time ) {
			continue;
		}

		// Check user targeting
		$user_targeting = get_post_meta( $modal->ID, 'modal_user_targeting', true ) ?: 'all';
		if ( $user_targeting === 'logged_in' && ! is_user_logged_in() ) {
			continue;
		}
		if ( $user_targeting === 'logged_out' && is_user_logged_in() ) {
			continue;
		}

		$modal_data[] = array(
			'id'                      => $modal->ID,
			'content'                 => apply_filters( 'the_content', $modal->post_content ),
			'triggerType'             => get_post_meta( $modal->ID, 'modal_trigger_type', true ) ?: 'page_load',
			'triggerDelay'            => (int) get_post_meta( $modal->ID, 'modal_trigger_delay', true ),
			'triggerScrollPercentage' => (int) get_post_meta( $modal->ID, 'modal_trigger_scroll_percentage', true ),
			'triggerClickSelector'    => get_post_meta( $modal->ID, 'modal_trigger_click_selector', true ),
			'triggerInactivitySeconds' => (int) get_post_meta( $modal->ID, 'modal_trigger_inactivity_seconds', true ),
			'triggerScrollElement'    => get_post_meta( $modal->ID, 'modal_trigger_scroll_element', true ),
			'pageViewsThreshold'      => (int) get_post_meta( $modal->ID, 'modal_page_views_threshold', true ),
			'sessionThreshold'        => (int) get_post_meta( $modal->ID, 'modal_session_threshold', true ),
			'frequencyLimit'          => (int) get_post_meta( $modal->ID, 'modal_frequency_limit', true ),
			'frequencyPeriod'         => get_post_meta( $modal->ID, 'modal_frequency_period', true ) ?: 'month',
			'devices'                 => get_post_meta( $modal->ID, 'modal_devices', true ) ?: 'all',
			'browsers'                => get_post_meta( $modal->ID, 'modal_browsers', true ) ?: 'all',
			'referrerFilter'          => get_post_meta( $modal->ID, 'modal_referrer_filter', true ),
			'position'                => get_post_meta( $modal->ID, 'modal_position', true ) ?: 'center',
			'animation'               => get_post_meta( $modal->ID, 'modal_animation', true ) ?: 'fade',
			'overlayOpacity'          => (int) get_post_meta( $modal->ID, 'modal_overlay_opacity', true ),
			'showCloseButton'         => (bool) get_post_meta( $modal->ID, 'modal_show_close_button', true ),
			'backdropClose'           => (bool) get_post_meta( $modal->ID, 'modal_backdrop_close', true ),
			'escClose'                => (bool) get_post_meta( $modal->ID, 'modal_esc_close', true ),
		);
	}

	if ( empty( $modal_data ) ) {
		return;
	}

	wp_enqueue_style(
		'modal-builder-frontend',
		plugins_url( 'build/style-index.css', __FILE__ ),
		array(),
		'0.1.0'
	);

	wp_enqueue_script(
		'modal-builder-frontend',
		plugins_url( 'build/view.js', __FILE__ ),
		array(),
		'0.1.0',
		true
	);

	wp_localize_script( 'modal-builder-frontend', 'modalBuilderData', array(
		'modals' => $modal_data,
	) );
}
add_action( 'wp_enqueue_scripts', 'modal_builder_enqueue_frontend_assets' );

/**
 * Enqueue editor assets.
 */
function modal_builder_enqueue_editor_assets() {
	$screen = get_current_screen();
	if ( ! $screen || $screen->post_type !== 'modal' ) {
		return;
	}

	wp_enqueue_script(
		'modal-builder-editor',
		plugins_url( 'build/index.js', __FILE__ ),
		array( 'wp-plugins', 'wp-edit-post', 'wp-element', 'wp-components', 'wp-data' ),
		'0.1.0',
		true
	);

	wp_enqueue_style(
		'modal-builder-editor',
		plugins_url( 'build/index.css', __FILE__ ),
		array( 'wp-edit-post' ),
		'0.1.0'
	);
}
add_action( 'admin_enqueue_scripts', 'modal_builder_enqueue_editor_assets' );]]></content>
  </file>
  <file path="src/block.json">
    <description>This file contains metadata about the block including its name, title, category, icon, and other properties.</description>
    <content><![CDATA[
  {
	"$schema": "https://schemas.wp.org/trunk/block.json",
	"apiVersion": 3,
	"name": "telex/block-modal-builder",
	"version": "0.1.0",
	"title": "Modal Builder",
	"category": "widgets",
	"icon": "welcome-view-site",
	"description": "Create beautiful modals and popups using the WordPress block editor",
	"example": {},
	"supports": {
		"html": false
	},
	"textdomain": "modal-builder-block-wp",
	"editorScript": "file:./index.js",
	"editorStyle": "file:./index.css",
	"style": "file:./style-index.css",
	"viewScript": "file:./view.js"
}
  ]]></content>
  </file>
  <file path="src/index.js">
    <description>This file registers the modal settings panel in the editor sidebar</description>
    <content><![CDATA[/**
 * WordPress dependencies
 */
import { registerPlugin } from '@wordpress/plugins';
import { PluginDocumentSettingPanel } from '@wordpress/edit-post';
import { PanelBody, SelectControl, TextControl, ToggleControl, RangeControl, DateTimePicker } from '@wordpress/components';
import { useSelect, useDispatch } from '@wordpress/data';
import { __ } from '@wordpress/i18n';
import { useState } from '@wordpress/element';

/**
 * Lets webpack process CSS, SASS or SCSS files referenced in JavaScript files.
 */
import './style.scss';
import './editor.scss';

const ModalSettings = () => {
	const postType = useSelect( ( select ) => {
		return select( 'core/editor' ).getCurrentPostType();
	}, [] );

	if ( postType !== 'modal' ) {
		return null;
	}

	const { editPost } = useDispatch( 'core/editor' );
	
	const meta = useSelect( ( select ) => {
		return select( 'core/editor' ).getEditedPostAttribute( 'meta' ) || {};
	}, [] );

	const {
		modal_trigger_type: triggerType = 'page_load',
		modal_trigger_delay: triggerDelay = 0,
		modal_trigger_scroll_percentage: triggerScrollPercentage = 50,
		modal_trigger_click_selector: triggerClickSelector = '',
		modal_trigger_inactivity_seconds: triggerInactivitySeconds = 30,
		modal_trigger_scroll_element: triggerScrollElement = '',
		modal_page_views_threshold: pageViewsThreshold = 0,
		modal_session_threshold: sessionThreshold = 0,
		modal_frequency_limit: frequencyLimit = 0,
		modal_frequency_period: frequencyPeriod = 'month',
		modal_user_targeting: userTargeting = 'all',
		modal_devices: devices = 'all',
		modal_browsers: browsers = 'all',
		modal_schedule_start: scheduleStart = '',
		modal_schedule_end: scheduleEnd = '',
		modal_referrer_filter: referrerFilter = '',
		modal_position: position = 'center',
		modal_animation: animation = 'fade',
		modal_overlay_opacity: overlayOpacity = 75,
		modal_show_close_button: showCloseButton = true,
		modal_backdrop_close: backdropClose = true,
		modal_esc_close: escClose = true,
	} = meta;

	const [ showScheduleStart, setShowScheduleStart ] = useState( false );
	const [ showScheduleEnd, setShowScheduleEnd ] = useState( false );

	const updateMeta = ( key, value ) => {
		editPost( { meta: { [ key ]: value } } );
	};

	return (
		<>
			<PluginDocumentSettingPanel
				name="modal-triggers"
				title={ __( 'Triggers', 'modal-builder' ) }
				icon="admin-settings"
			>
				<SelectControl
					label={ __( 'Trigger Type', 'modal-builder' ) }
					value={ triggerType }
					options={ [
						{ label: __( 'On Page Load', 'modal-builder' ), value: 'page_load' },
						{ label: __( 'On Scroll', 'modal-builder' ), value: 'scroll' },
						{ label: __( 'On Click', 'modal-builder' ), value: 'click' },
						{ label: __( 'Exit Intent', 'modal-builder' ), value: 'exit_intent' },
						{ label: __( 'After Inactivity', 'modal-builder' ), value: 'inactivity' },
						{ label: __( 'On Scroll To Element', 'modal-builder' ), value: 'scroll_element' },
					] }
					onChange={ ( value ) => updateMeta( 'modal_trigger_type', value ) }
				/>

				{ ( triggerType === 'page_load' || triggerType === 'exit_intent' || triggerType === 'inactivity' ) && (
					<RangeControl
						label={ __( 'Delay (seconds)', 'modal-builder' ) }
						value={ triggerDelay }
						onChange={ ( value ) => updateMeta( 'modal_trigger_delay', value ) }
						min={ 0 }
						max={ 60 }
						help={ __( 'Number of seconds to wait before showing modal', 'modal-builder' ) }
					/>
				) }

				{ triggerType === 'scroll' && (
					<RangeControl
						label={ __( 'Scroll Percentage', 'modal-builder' ) }
						value={ triggerScrollPercentage }
						onChange={ ( value ) => updateMeta( 'modal_trigger_scroll_percentage', value ) }
						min={ 0 }
						max={ 100 }
						help={ __( 'Percentage of page scrolled before showing modal', 'modal-builder' ) }
					/>
				) }

				{ triggerType === 'click' && (
					<TextControl
						label={ __( 'CSS Selector', 'modal-builder' ) }
						value={ triggerClickSelector }
						onChange={ ( value ) => updateMeta( 'modal_trigger_click_selector', value ) }
						help={ __( 'CSS selector for clickable elements (e.g., .button-class, #my-button)', 'modal-builder' ) }
						placeholder=".open-modal"
					/>
				) }

				{ triggerType === 'inactivity' && (
					<RangeControl
						label={ __( 'Inactivity Duration (seconds)', 'modal-builder' ) }
						value={ triggerInactivitySeconds }
						onChange={ ( value ) => updateMeta( 'modal_trigger_inactivity_seconds', value ) }
						min={ 5 }
						max={ 300 }
						help={ __( 'Show modal after this many seconds of no activity', 'modal-builder' ) }
					/>
				) }

				{ triggerType === 'scroll_element' && (
					<TextControl
						label={ __( 'Element Selector', 'modal-builder' ) }
						value={ triggerScrollElement }
						onChange={ ( value ) => updateMeta( 'modal_trigger_scroll_element', value ) }
						help={ __( 'CSS selector for element to trigger modal when scrolled to', 'modal-builder' ) }
						placeholder="#trigger-section"
					/>
				) }
			</PluginDocumentSettingPanel>

			<PluginDocumentSettingPanel
				name="modal-display-rules"
				title={ __( 'Display Rules', 'modal-builder' ) }
				icon="filter"
			>
				<RangeControl
					label={ __( 'Page Views Threshold', 'modal-builder' ) }
					value={ pageViewsThreshold }
					onChange={ ( value ) => updateMeta( 'modal_page_views_threshold', value ) }
					min={ 0 }
					max={ 50 }
					help={ __( 'Show only after user has viewed this many pages (0 = no limit)', 'modal-builder' ) }
				/>

				<RangeControl
					label={ __( 'Session Threshold', 'modal-builder' ) }
					value={ sessionThreshold }
					onChange={ ( value ) => updateMeta( 'modal_session_threshold', value ) }
					min={ 0 }
					max={ 20 }
					help={ __( 'Show only after this many sessions (0 = no limit)', 'modal-builder' ) }
				/>

				<PanelBody title={ __( 'Frequency Capping', 'modal-builder' ) } initialOpen={ false }>
					<RangeControl
						label={ __( 'Display Limit', 'modal-builder' ) }
						value={ frequencyLimit }
						onChange={ ( value ) => updateMeta( 'modal_frequency_limit', value ) }
						min={ 0 }
						max={ 50 }
						help={ __( 'Maximum number of times to show (0 = unlimited)', 'modal-builder' ) }
					/>

					<SelectControl
						label={ __( 'Time Period', 'modal-builder' ) }
						value={ frequencyPeriod }
						options={ [
							{ label: __( 'Per Session', 'modal-builder' ), value: 'session' },
							{ label: __( 'Per Day', 'modal-builder' ), value: 'day' },
							{ label: __( 'Per Week', 'modal-builder' ), value: 'week' },
							{ label: __( 'Per Month', 'modal-builder' ), value: 'month' },
							{ label: __( 'Lifetime', 'modal-builder' ), value: 'lifetime' },
						] }
						onChange={ ( value ) => updateMeta( 'modal_frequency_period', value ) }
					/>
				</PanelBody>

				<SelectControl
					label={ __( 'User Targeting', 'modal-builder' ) }
					value={ userTargeting }
					options={ [
						{ label: __( 'All Users', 'modal-builder' ), value: 'all' },
						{ label: __( 'Logged In Only', 'modal-builder' ), value: 'logged_in' },
						{ label: __( 'Logged Out Only', 'modal-builder' ), value: 'logged_out' },
					] }
					onChange={ ( value ) => updateMeta( 'modal_user_targeting', value ) }
				/>

				<SelectControl
					label={ __( 'Device Targeting', 'modal-builder' ) }
					value={ devices }
					options={ [
						{ label: __( 'All Devices', 'modal-builder' ), value: 'all' },
						{ label: __( 'Desktop Only', 'modal-builder' ), value: 'desktop' },
						{ label: __( 'Tablet Only', 'modal-builder' ), value: 'tablet' },
						{ label: __( 'Mobile Only', 'modal-builder' ), value: 'mobile' },
					] }
					onChange={ ( value ) => updateMeta( 'modal_devices', value ) }
				/>

				<SelectControl
					label={ __( 'Browser Detection', 'modal-builder' ) }
					value={ browsers }
					options={ [
						{ label: __( 'All Browsers', 'modal-builder' ), value: 'all' },
						{ label: __( 'Chrome Only', 'modal-builder' ), value: 'chrome' },
						{ label: __( 'Firefox Only', 'modal-builder' ), value: 'firefox' },
						{ label: __( 'Safari Only', 'modal-builder' ), value: 'safari' },
						{ label: __( 'Edge Only', 'modal-builder' ), value: 'edge' },
					] }
					onChange={ ( value ) => updateMeta( 'modal_browsers', value ) }
				/>

				<PanelBody title={ __( 'Scheduling', 'modal-builder' ) } initialOpen={ false }>
					<ToggleControl
						label={ __( 'Set Start Date/Time', 'modal-builder' ) }
						checked={ showScheduleStart }
						onChange={ setShowScheduleStart }
					/>
					{ showScheduleStart && (
						<DateTimePicker
							currentDate={ scheduleStart }
							onChange={ ( value ) => updateMeta( 'modal_schedule_start', value ) }
						/>
					) }

					<ToggleControl
						label={ __( 'Set End Date/Time', 'modal-builder' ) }
						checked={ showScheduleEnd }
						onChange={ setShowScheduleEnd }
					/>
					{ showScheduleEnd && (
						<DateTimePicker
							currentDate={ scheduleEnd }
							onChange={ ( value ) => updateMeta( 'modal_schedule_end', value ) }
						/>
					) }
				</PanelBody>

				<TextControl
					label={ __( 'URL Referrer Filter', 'modal-builder' ) }
					value={ referrerFilter }
					onChange={ ( value ) => updateMeta( 'modal_referrer_filter', value ) }
					help={ __( 'Show only to users from specific referrer (e.g., google.com, facebook.com)', 'modal-builder' ) }
					placeholder="google.com"
				/>
			</PluginDocumentSettingPanel>

			<PluginDocumentSettingPanel
				name="modal-display-options"
				title={ __( 'Display Options', 'modal-builder' ) }
				icon="admin-appearance"
			>
				<SelectControl
					label={ __( 'Position', 'modal-builder' ) }
					value={ position }
					options={ [
						{ label: __( 'Center', 'modal-builder' ), value: 'center' },
						{ label: __( 'Top Left', 'modal-builder' ), value: 'top-left' },
						{ label: __( 'Top Center', 'modal-builder' ), value: 'top-center' },
						{ label: __( 'Top Right', 'modal-builder' ), value: 'top-right' },
						{ label: __( 'Bottom Left', 'modal-builder' ), value: 'bottom-left' },
						{ label: __( 'Bottom Center', 'modal-builder' ), value: 'bottom-center' },
						{ label: __( 'Bottom Right', 'modal-builder' ), value: 'bottom-right' },
					] }
					onChange={ ( value ) => updateMeta( 'modal_position', value ) }
				/>

				<SelectControl
					label={ __( 'Animation Effect', 'modal-builder' ) }
					value={ animation }
					options={ [
						{ label: __( 'Fade', 'modal-builder' ), value: 'fade' },
						{ label: __( 'Slide Up', 'modal-builder' ), value: 'slide-up' },
						{ label: __( 'Slide Down', 'modal-builder' ), value: 'slide-down' },
						{ label: __( 'Slide Left', 'modal-builder' ), value: 'slide-left' },
						{ label: __( 'Slide Right', 'modal-builder' ), value: 'slide-right' },
						{ label: __( 'Zoom In', 'modal-builder' ), value: 'zoom-in' },
						{ label: __( 'Zoom Out', 'modal-builder' ), value: 'zoom-out' },
					] }
					onChange={ ( value ) => updateMeta( 'modal_animation', value ) }
				/>

				<RangeControl
					label={ __( 'Overlay Opacity', 'modal-builder' ) }
					value={ overlayOpacity }
					onChange={ ( value ) => updateMeta( 'modal_overlay_opacity', value ) }
					min={ 0 }
					max={ 100 }
					help={ __( 'Background overlay darkness (0 = transparent, 100 = opaque)', 'modal-builder' ) }
				/>

				<ToggleControl
					label={ __( 'Show Close Button', 'modal-builder' ) }
					checked={ showCloseButton }
					onChange={ ( value ) => updateMeta( 'modal_show_close_button', value ) }
				/>

				<ToggleControl
					label={ __( 'Close on Backdrop Click', 'modal-builder' ) }
					checked={ backdropClose }
					onChange={ ( value ) => updateMeta( 'modal_backdrop_close', value ) }
				/>

				<ToggleControl
					label={ __( 'Close with ESC Key', 'modal-builder' ) }
					checked={ escClose }
					onChange={ ( value ) => updateMeta( 'modal_esc_close', value ) }
				/>
			</PluginDocumentSettingPanel>
		</>
	);
};

registerPlugin( 'modal-builder-settings', {
	render: ModalSettings,
} );]]></content>
  </file>
  <file path="src/edit.js">
    <description>This file is not used for this plugin as we're using a custom post type with the full editor.</description>
    <content><![CDATA[
// Not used - settings are registered via src/index.js
]]></content>
  </file>
  <file path="src/save.js">
    <description>This file is not used for this plugin as modals are rendered dynamically on the frontend.</description>
    <content><![CDATA[
// Not used - modals are rendered dynamically on the frontend
]]></content>
  </file>
  <file path="src/style.scss">
    <description>This file contains styles for the modal on the frontend.</description>
    <content><![CDATA[/**
 * Frontend modal styles with position and animation support
 */

.modal-builder-overlay {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	display: flex;
	z-index: 999999;
	opacity: 0;
	transition: opacity 0.3s ease;
	padding: 20px;
	box-sizing: border-box;

	// Position variants
	&[data-position="center"] {
		align-items: center;
		justify-content: center;
	}

	&[data-position="top-left"] {
		align-items: flex-start;
		justify-content: flex-start;
	}

	&[data-position="top-center"] {
		align-items: flex-start;
		justify-content: center;
	}

	&[data-position="top-right"] {
		align-items: flex-start;
		justify-content: flex-end;
	}

	&[data-position="bottom-left"] {
		align-items: flex-end;
		justify-content: flex-start;
	}

	&[data-position="bottom-center"] {
		align-items: flex-end;
		justify-content: center;
	}

	&[data-position="bottom-right"] {
		align-items: flex-end;
		justify-content: flex-end;
	}

	&.is-visible {
		opacity: 1;
	}

	&.is-closing {
		opacity: 0;
	}
}

.modal-builder-container {
	position: relative;
	background: #fff;
	border-radius: 8px;
	box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
	max-width: 600px;
	width: 100%;
	max-height: 90vh;
	overflow: auto;
	transition: transform 0.3s ease, opacity 0.3s ease;

	// Animation: Fade
	.modal-builder-overlay[data-animation="fade"] & {
		opacity: 0;
	}

	.modal-builder-overlay[data-animation="fade"].is-visible & {
		opacity: 1;
	}

	.modal-builder-overlay[data-animation="fade"].is-closing & {
		opacity: 0;
	}

	// Animation: Slide Up
	.modal-builder-overlay[data-animation="slide-up"] & {
		transform: translateY(50px);
		opacity: 0;
	}

	.modal-builder-overlay[data-animation="slide-up"].is-visible & {
		transform: translateY(0);
		opacity: 1;
	}

	.modal-builder-overlay[data-animation="slide-up"].is-closing & {
		transform: translateY(50px);
		opacity: 0;
	}

	// Animation: Slide Down
	.modal-builder-overlay[data-animation="slide-down"] & {
		transform: translateY(-50px);
		opacity: 0;
	}

	.modal-builder-overlay[data-animation="slide-down"].is-visible & {
		transform: translateY(0);
		opacity: 1;
	}

	.modal-builder-overlay[data-animation="slide-down"].is-closing & {
		transform: translateY(-50px);
		opacity: 0;
	}

	// Animation: Slide Left
	.modal-builder-overlay[data-animation="slide-left"] & {
		transform: translateX(50px);
		opacity: 0;
	}

	.modal-builder-overlay[data-animation="slide-left"].is-visible & {
		transform: translateX(0);
		opacity: 1;
	}

	.modal-builder-overlay[data-animation="slide-left"].is-closing & {
		transform: translateX(50px);
		opacity: 0;
	}

	// Animation: Slide Right
	.modal-builder-overlay[data-animation="slide-right"] & {
		transform: translateX(-50px);
		opacity: 0;
	}

	.modal-builder-overlay[data-animation="slide-right"].is-visible & {
		transform: translateX(0);
		opacity: 1;
	}

	.modal-builder-overlay[data-animation="slide-right"].is-closing & {
		transform: translateX(-50px);
		opacity: 0;
	}

	// Animation: Zoom In
	.modal-builder-overlay[data-animation="zoom-in"] & {
		transform: scale(0.8);
		opacity: 0;
	}

	.modal-builder-overlay[data-animation="zoom-in"].is-visible & {
		transform: scale(1);
		opacity: 1;
	}

	.modal-builder-overlay[data-animation="zoom-in"].is-closing & {
		transform: scale(0.8);
		opacity: 0;
	}

	// Animation: Zoom Out
	.modal-builder-overlay[data-animation="zoom-out"] & {
		transform: scale(1.2);
		opacity: 0;
	}

	.modal-builder-overlay[data-animation="zoom-out"].is-visible & {
		transform: scale(1);
		opacity: 1;
	}

	.modal-builder-overlay[data-animation="zoom-out"].is-closing & {
		transform: scale(1.2);
		opacity: 0;
	}
}

.modal-builder-close {
	position: absolute;
	top: 15px;
	right: 15px;
	width: 32px;
	height: 32px;
	border: none;
	background: rgba(0, 0, 0, 0.1);
	border-radius: 50%;
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
	transition: background-color 0.2s ease;
	z-index: 1;
	padding: 0;

	&:hover {
		background: rgba(0, 0, 0, 0.2);
	}

	&:focus {
		outline: 2px solid #007cba;
		outline-offset: 2px;
	}

	&::before,
	&::after {
		content: '';
		position: absolute;
		width: 16px;
		height: 2px;
		background-color: #333;
	}

	&::before {
		transform: rotate(45deg);
	}

	&::after {
		transform: rotate(-45deg);
	}
}

.modal-builder-content {
	padding: 40px 30px 30px;

	> * {
		max-width: 100%;
	}

	p:first-child {
		margin-top: 0;
	}

	p:last-child {
		margin-bottom: 0;
	}
}

// Device visibility
@media (min-width: 1024px) {
	.modal-builder-overlay[data-devices="tablet"],
	.modal-builder-overlay[data-devices="mobile"] {
		display: none !important;
	}
}

@media (min-width: 768px) and (max-width: 1023px) {
	.modal-builder-overlay[data-devices="desktop"],
	.modal-builder-overlay[data-devices="mobile"] {
		display: none !important;
	}
}

@media (max-width: 767px) {
	.modal-builder-overlay[data-devices="desktop"],
	.modal-builder-overlay[data-devices="tablet"] {
		display: none !important;
	}

	.modal-builder-container {
		max-width: 100%;
		border-radius: 0;
		max-height: 100vh;
	}

	.modal-builder-content {
		padding: 50px 20px 20px;
	}
}]]></content>
  </file>
  <file path="src/editor.scss">
    <description>This file contains styles for the modal settings in the editor.</description>
    <content><![CDATA[
/**
 * Editor styles for modal settings panel
 */

.modal-builder-settings-panel {
	.components-panel__body-title {
		display: flex;
		align-items: center;

		svg {
			margin-right: 8px;
		}
	}

	.components-base-control {
		margin-bottom: 20px;
	}

	.components-base-control__help {
		font-size: 12px;
		color: #757575;
		margin-top: 8px;
	}
}
	]]></content>
  </file>
  <file path="src/view.js">
    <description>This file contains the frontend JavaScript for modal functionality.</description>
    <content><![CDATA[/**
 * Frontend modal functionality with advanced triggers and tracking
 */

( function() {
	'use strict';

	if ( typeof modalBuilderData === 'undefined' || ! modalBuilderData.modals ) {
		return;
	}

	const modals = modalBuilderData.modals;
	let activeModal = null;
	let focusedElementBeforeModal = null;
	const STORAGE_PREFIX = 'mb_';

	/**
	 * Local storage helpers
	 */
	function setStorage( key, value, days = 365 ) {
		const expires = new Date();
		expires.setTime( expires.getTime() + ( days * 24 * 60 * 60 * 1000 ) );
		try {
			localStorage.setItem( STORAGE_PREFIX + key, JSON.stringify( {
				value,
				expires: expires.getTime(),
			} ) );
		} catch ( e ) {
			// Fallback to cookies if localStorage unavailable
			document.cookie = STORAGE_PREFIX + key + '=' + JSON.stringify( value ) + ';expires=' + expires.toUTCString() + ';path=/';
		}
	}

	function getStorage( key ) {
		try {
			const item = localStorage.getItem( STORAGE_PREFIX + key );
			if ( ! item ) return null;
			const data = JSON.parse( item );
			if ( data.expires && Date.now() > data.expires ) {
				localStorage.removeItem( STORAGE_PREFIX + key );
				return null;
			}
			return data.value;
		} catch ( e ) {
			return null;
		}
	}

	/**
	 * Session management
	 */
	function getSessionId() {
		let sessionId = sessionStorage.getItem( STORAGE_PREFIX + 'session_id' );
		if ( ! sessionId ) {
			sessionId = Date.now() + '_' + Math.random().toString( 36 ).substr( 2, 9 );
			sessionStorage.setItem( STORAGE_PREFIX + 'session_id', sessionId );
		}
		return sessionId;
	}

	function getSessionCount() {
		const sessions = getStorage( 'sessions' ) || [];
		return sessions.length;
	}

	function incrementSessionCount() {
		const sessionId = getSessionId();
		const sessions = getStorage( 'sessions' ) || [];
		if ( ! sessions.includes( sessionId ) ) {
			sessions.push( sessionId );
			setStorage( 'sessions', sessions, 365 );
		}
	}

	incrementSessionCount();

	/**
	 * Page view tracking
	 */
	function getPageViewCount() {
		const sessionId = getSessionId();
		const key = 'pageviews_' + sessionId;
		return parseInt( sessionStorage.getItem( key ) || '0', 10 );
	}

	function incrementPageViewCount() {
		const sessionId = getSessionId();
		const key = 'pageviews_' + sessionId;
		const count = getPageViewCount() + 1;
		sessionStorage.setItem( key, count.toString() );
	}

	incrementPageViewCount();

	/**
	 * Browser detection
	 */
	function detectBrowser() {
		const ua = navigator.userAgent;
		if ( ua.indexOf( 'Chrome' ) > -1 && ua.indexOf( 'Edg' ) === -1 ) return 'chrome';
		if ( ua.indexOf( 'Safari' ) > -1 && ua.indexOf( 'Chrome' ) === -1 ) return 'safari';
		if ( ua.indexOf( 'Firefox' ) > -1 ) return 'firefox';
		if ( ua.indexOf( 'Edg' ) > -1 ) return 'edge';
		return 'other';
	}

	/**
	 * Check frequency limits
	 */
	function checkFrequencyLimit( modalId, limit, period ) {
		if ( limit === 0 ) return true;

		const key = 'frequency_' + modalId;
		const data = getStorage( key ) || { count: 0, period, timestamp: Date.now() };

		const periodMap = {
			session: 0,
			day: 24 * 60 * 60 * 1000,
			week: 7 * 24 * 60 * 60 * 1000,
			month: 30 * 24 * 60 * 60 * 1000,
			lifetime: Infinity,
		};

		const timeSince = Date.now() - data.timestamp;
		const periodDuration = periodMap[ period ];

		if ( period === 'session' ) {
			const sessionKey = 'frequency_session_' + modalId;
			const sessionCount = parseInt( sessionStorage.getItem( sessionKey ) || '0', 10 );
			return sessionCount < limit;
		}

		if ( periodDuration !== Infinity && timeSince > periodDuration ) {
			setStorage( key, { count: 0, period, timestamp: Date.now() } );
			return true;
		}

		return data.count < limit;
	}

	function incrementFrequencyCount( modalId, period ) {
		const key = 'frequency_' + modalId;
		const data = getStorage( key ) || { count: 0, period, timestamp: Date.now() };
		data.count++;
		setStorage( key, data );

		if ( period === 'session' ) {
			const sessionKey = 'frequency_session_' + modalId;
			const sessionCount = parseInt( sessionStorage.getItem( sessionKey ) || '0', 10 );
			sessionStorage.setItem( sessionKey, ( sessionCount + 1 ).toString() );
		}
	}

	/**
	 * Check if modal should show based on all rules
	 */
	function shouldShowModal( modal ) {
		// Check page views threshold
		if ( modal.pageViewsThreshold > 0 && getPageViewCount() < modal.pageViewsThreshold ) {
			return false;
		}

		// Check session threshold
		if ( modal.sessionThreshold > 0 && getSessionCount() < modal.sessionThreshold ) {
			return false;
		}

		// Check frequency limit
		if ( modal.frequencyLimit > 0 && ! checkFrequencyLimit( modal.id, modal.frequencyLimit, modal.frequencyPeriod ) ) {
			return false;
		}

		// Check browser targeting
		if ( modal.browsers !== 'all' && detectBrowser() !== modal.browsers ) {
			return false;
		}

		// Check referrer filter
		if ( modal.referrerFilter ) {
			const referrer = document.referrer;
			if ( ! referrer || referrer.indexOf( modal.referrerFilter ) === -1 ) {
				return false;
			}
		}

		return true;
	}

	/**
	 * Create modal HTML with position and animation
	 */
	function createModal( modal ) {
		const overlay = document.createElement( 'div' );
		overlay.className = 'modal-builder-overlay';
		overlay.setAttribute( 'role', 'dialog' );
		overlay.setAttribute( 'aria-modal', 'true' );
		overlay.setAttribute( 'aria-labelledby', 'modal-builder-' + modal.id );
		overlay.setAttribute( 'data-modal-id', modal.id );
		overlay.setAttribute( 'data-position', modal.position );
		overlay.setAttribute( 'data-animation', modal.animation );
		overlay.style.backgroundColor = 'rgba(0, 0, 0, ' + ( modal.overlayOpacity / 100 ) + ')';

		if ( modal.devices !== 'all' ) {
			overlay.setAttribute( 'data-devices', modal.devices );
		}

		const container = document.createElement( 'div' );
		container.className = 'modal-builder-container';

		if ( modal.showCloseButton ) {
			const closeButton = document.createElement( 'button' );
			closeButton.className = 'modal-builder-close';
			closeButton.setAttribute( 'aria-label', 'Close modal' );
			closeButton.setAttribute( 'type', 'button' );
			container.appendChild( closeButton );
		}

		const content = document.createElement( 'div' );
		content.className = 'modal-builder-content';
		content.id = 'modal-builder-' + modal.id;
		content.innerHTML = modal.content;

		container.appendChild( content );
		overlay.appendChild( container );

		return overlay;
	}

	/**
	 * Show modal
	 */
	function showModal( modal ) {
		if ( ! shouldShowModal( modal ) ) {
			return;
		}

		const modalElement = createModal( modal );
		document.body.appendChild( modalElement );

		focusedElementBeforeModal = document.activeElement;
		activeModal = modalElement;

		requestAnimationFrame( () => {
			modalElement.classList.add( 'is-visible' );
		} );

		incrementFrequencyCount( modal.id, modal.frequencyPeriod );

		const closeButton = modalElement.querySelector( '.modal-builder-close' );
		if ( closeButton ) {
			closeButton.addEventListener( 'click', closeModal );
			closeButton.focus();
		}

		if ( modal.backdropClose ) {
			modalElement.addEventListener( 'click', function( e ) {
				if ( e.target === modalElement ) {
					closeModal();
				}
			} );
		}

		trapFocus( modalElement, modal.escClose );
	}

	/**
	 * Close modal
	 */
	function closeModal() {
		if ( ! activeModal ) {
			return;
		}

		activeModal.classList.add( 'is-closing' );

		setTimeout( () => {
			if ( activeModal && activeModal.parentNode ) {
				activeModal.parentNode.removeChild( activeModal );
			}
			activeModal = null;

			if ( focusedElementBeforeModal ) {
				focusedElementBeforeModal.focus();
			}
		}, 300 );
	}

	/**
	 * Trap focus within modal
	 */
	function trapFocus( element, escClose ) {
		const focusableElements = element.querySelectorAll(
			'a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])'
		);

		if ( focusableElements.length === 0 ) {
			return;
		}

		const firstFocusable = focusableElements[ 0 ];
		const lastFocusable = focusableElements[ focusableElements.length - 1 ];

		element.addEventListener( 'keydown', function( e ) {
			if ( e.key === 'Escape' && escClose ) {
				closeModal();
				return;
			}

			if ( e.key !== 'Tab' ) {
				return;
			}

			if ( e.shiftKey ) {
				if ( document.activeElement === firstFocusable ) {
					lastFocusable.focus();
					e.preventDefault();
				}
			} else {
				if ( document.activeElement === lastFocusable ) {
					firstFocusable.focus();
					e.preventDefault();
				}
			}
		} );
	}

	/**
	 * Setup triggers for each modal
	 */
	modals.forEach( function( modal ) {
		switch ( modal.triggerType ) {
			case 'page_load':
				if ( modal.triggerDelay > 0 ) {
					setTimeout( () => showModal( modal ), modal.triggerDelay * 1000 );
				} else {
					showModal( modal );
				}
				break;

			case 'scroll':
				let scrollTriggered = false;
				const checkScroll = function() {
					if ( scrollTriggered ) return;
					const scrollPercentage = ( window.scrollY / ( document.documentElement.scrollHeight - window.innerHeight ) ) * 100;
					if ( scrollPercentage >= modal.triggerScrollPercentage ) {
						scrollTriggered = true;
						showModal( modal );
						window.removeEventListener( 'scroll', checkScroll );
					}
				};
				window.addEventListener( 'scroll', checkScroll );
				break;

			case 'click':
				if ( modal.triggerClickSelector ) {
					document.addEventListener( 'click', function( e ) {
						if ( e.target.matches( modal.triggerClickSelector ) || e.target.closest( modal.triggerClickSelector ) ) {
							e.preventDefault();
							showModal( modal );
						}
					} );
				}
				break;

			case 'exit_intent':
				let exitTriggered = false;
				document.addEventListener( 'mouseout', function( e ) {
					if ( exitTriggered ) return;
					if ( ! e.relatedTarget && e.clientY < 10 ) {
						exitTriggered = true;
						if ( modal.triggerDelay > 0 ) {
							setTimeout( () => showModal( modal ), modal.triggerDelay * 1000 );
						} else {
							showModal( modal );
						}
					}
				} );
				break;

			case 'inactivity':
				let inactivityTimer;
				let inactivityTriggered = false;
				const resetInactivityTimer = function() {
					if ( inactivityTriggered ) return;
					clearTimeout( inactivityTimer );
					inactivityTimer = setTimeout( () => {
						inactivityTriggered = true;
						showModal( modal );
					}, modal.triggerInactivitySeconds * 1000 );
				};
				[ 'mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart' ].forEach( function( event ) {
					document.addEventListener( event, resetInactivityTimer, true );
				} );
				resetInactivityTimer();
				break;

			case 'scroll_element':
				if ( modal.triggerScrollElement ) {
					const observer = new IntersectionObserver( function( entries ) {
						entries.forEach( function( entry ) {
							if ( entry.isIntersecting ) {
								showModal( modal );
								observer.disconnect();
							}
						} );
					}, { threshold: 0.5 } );

					const targetElement = document.querySelector( modal.triggerScrollElement );
					if ( targetElement ) {
						observer.observe( targetElement );
					}
				}
				break;
		}
	} );

} )();]]></content>
  </file>
  <file path="src/render.php">
    <description>This file is not used as modals are rendered via JavaScript on the frontend.</description>
    <content><![CDATA[]]></content>
  </file>
  <file path="package.json">
    <description>Package configuration for the modal builder plugin.</description>
    <content><![CDATA[
  {
	"name": "modal-builder",
	"version": "0.1.0",
	"description": "Create beautiful modals and popups using the WordPress block editor with powerful targeting and display options.",
	"author": "WordPress Telex",
	"license": "GPL-2.0-or-later",
	"main": "build/index.js",
	"scripts": {
		"build": "wp-scripts build",
		"format": "wp-scripts format",
		"lint:css": "wp-scripts lint-style",
		"lint:js": "wp-scripts lint-js",
		"packages-update": "wp-scripts packages-update",
		"plugin-zip": "wp-scripts plugin-zip",
		"start": "wp-scripts start"
	},
    "devDependencies": {
        "@wordpress/scripts": "^30.15.0"
	}
}
]]></content>
  </file>
</artefact>